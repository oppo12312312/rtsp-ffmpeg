<!--
 * @Description: 
 * @Author: zhongshuai
 * @Date: 2019-08-23 13:56:02
 * @LastEditors: zhongshuai
 * @LastEditTime: 2019-09-05 16:22:06
 -->
<!DOCTYPE html>
<html>

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>flv.js demo</title>
    <link rel="stylesheet" type="text/css" href="./demo.css" />
    <script src="./flv.js"></script>
</head>

<body>
    <div class="content">
        <div class="fx1">
                <video id="videoElement1" name="videoElement" class="centeredVideo" muted autoplay>
                        Your browser is too old which doesn't support HTML5 video.
                    </video>
                    <video id="videoElement2" name="videoElement" class="centeredVideo" muted autoplay>
                            Your browser is too old which doesn't support HTML5 video.
                        </video>
            </div>
            <div class="fx1">
                    <video id="videoElement3" name="videoElement" class="centeredVideo" muted autoplay>
                            Your browser is too old which doesn't support HTML5 video.
                        </video>
                        <video id="videoElement4" name="videoElement" class="centeredVideo" muted autoplay>
                                Your browser is too old which doesn't support HTML5 video.
                        </video>
                </div>
   </div>
            
  

 
    
    <script>
        var urls = [
			// "rtsp://admin:Abc123456@10.231.20.158/cam/realmonitor?channel=1&subtype=0",
			// "rtsp://10.231.20.223/user=admin&password=&channel=1&stream=0.sdp?",
			// "rtsp://admin:admin@10.231.20.156/1",
			"rtsp://admin:admin@10.231.20.155/1",
			// "rtsp://admin:admin@10.231.20.155/1"
        ]
        var flvPlayer;

        for(let i = 0; i < urls.length; i++){ 
            if (flvjs.isSupported()) {
                let player = document.getElementById('videoElement'+(i+1));
                flvPlayer = flvjs.createPlayer({
                    type: 'flv',
                    duration: 0,
                    isLive: true,
                    url: "ws://127.0.0.1:3000/cameraStream?url="+escape(urls[i])
                },{
                    enableStashBuffer: false,
                    lazyLoad: false,
                    lazyLoadMaxDuration: 0,
                    lazyLoadRecoverDuration: 0,
                    deferLoadAfterSourceOpen: false,
                })
				flvPlayer.attachMediaElement(player);
				flvPlayer.on(flvjs.Events.METADATA_ARRIVED,function(data){
					console.log(data)
				})
				flvPlayer.on(flvjs.Events.SCRIPTDATA_ARRIVED,function(data){
                    console.log(data)

				})
                flvPlayer.load(); //加载
                flvPlayer.play();
            }
        }
        document.addEventListener('visibilitychange',function(){ 
            for(let i = 0; i < urls.length; i++){
                let video = document.getElementById('videoElement'+(i+1));
                let buffered = video.buffered
                if (buffered.length > 0) {
                let end = buffered.end(0)
                if (end - video.currentTime > 0.15) {
                    video.currentTime = end - 0.1
                }
                }
            }
        })




    </script>
    
</body>

</html>